<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>The karabo_euxfel Module &#8212; OnDA 2019.8.0 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/my-styles.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The psana_lcls Module" href="onda.data_retrieval_layer.frameworks.psana_lcls.html" />
    <link rel="prev" title="The hidra_petra3 Module" href="onda.data_retrieval_layer.frameworks.hidra_petra3.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          OnDA</a>
        <span class="navbar-text navbar-version pull-left"><b>2019.8.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="documentation_getting_onda.html">Getting OnDA</a></li>
                <li><a href="documentation_running_onda.html">Running OnDA</a></li>
                <li><a href="documentation_advanced_topics.html">Advanced Topics</a></li>
                <li><a href="https://github.com/ondateam/onda">Source Code</a></li>
            
            
              
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p>[<a class="reference internal" href="onda.html"><span class="doc">Back to top of code documentation</span></a>]</p>
<div class="section" id="module-onda.data_retrieval_layer.frameworks.karabo_euxfel">
<span id="the-karabo-euxfel-module"></span><h1>The karabo_euxfel Module<a class="headerlink" href="#module-onda.data_retrieval_layer.frameworks.karabo_euxfel" title="Permalink to this headline">¶</a></h1>
<p>Retrieval of events from Karabo at the European XFEL.</p>
<p>This module contains functions and classes that retrieve data events from the Karabo
framework at the European XFEL facility.</p>
<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.initialize_event_source">
<code class="descname">initialize_event_source</code><span class="sig-paren">(</span><em>source</em>, <em>node_pool_size</em>, <em>monitor_params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#initialize_event_source"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.initialize_event_source" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes the Karabo event source at XFEL.</p>
<p>This function must be called on the master node before the <a class="reference internal" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.event_generator" title="onda.data_retrieval_layer.frameworks.karabo_euxfel.event_generator"><code class="xref py py-func docutils literal notranslate"><span class="pre">event_generator()</span></code></a>
function is called on the worker nodes. There is no need to initialize the Karabo
event source, so this function actually does nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>source</strong> (<em>str</em>) – the hostname (or IP address) and the port where the Karabo Bridge
is running, separated by a colon.</li>
<li><strong>node_pool_size</strong> (<em>int</em>) – the total number of nodes in the OnDA pool, including all
the worker nodes and the master node.</li>
<li><strong>monitor_params</strong> (<a class="reference internal" href="onda.utils.parameters.html#onda.utils.parameters.MonitorParams" title="onda.utils.parameters.MonitorParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">MonitorParams</span></code></a>) – an object
storing the OnDA monitor parameters from the configuration file.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.event_generator">
<code class="descname">event_generator</code><span class="sig-paren">(</span><em>source</em>, <em>node_rank</em>, <em>node_pool_size</em>, <em>monitor_params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#event_generator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.event_generator" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves events to process from Karabo at XFEL .</p>
<p>This function must be called on each worker node after the
<a class="reference internal" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.initialize_event_source" title="onda.data_retrieval_layer.frameworks.karabo_euxfel.initialize_event_source"><code class="xref py py-func docutils literal notranslate"><span class="pre">initialize_event_source()</span></code></a> function has been called on the master node.
The function is a generator and it returns an iterator over the events that the
calling worker must process.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>source</strong> (<em>str</em>) – the hostname (or IP address) and the port where the Karabo Bridge
is running, separated by a colon.</li>
<li><strong>node_rank</strong> (<em>int</em>) – the rank, in the OnDA pool, of the worker node calling the
function.</li>
<li><strong>node_pool_size</strong> (<em>int</em>) – the total number of nodes in the OnDA pool, including all
the worker nodes and the master node.</li>
<li><strong>monitor_params</strong> (<a class="reference internal" href="onda.utils.parameters.html#onda.utils.parameters.MonitorParams" title="onda.utils.parameters.MonitorParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">MonitorParams</span></code></a>) – an object
storing the OnDA monitor parameters from the configuration file.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Yields:</th><td class="field-body"><p class="first"><a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a> – an object storing the event data.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="onda.utils.exceptions.html#onda.utils.exceptions.OndaInvalidSourceError" title="onda.utils.exceptions.OndaInvalidSourceError"><code class="xref py py-class docutils literal notranslate"><span class="pre">OndaInvalidSourceError</span></code></a> – if the format of the
‘source’ argument is wrong.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.open_event">
<code class="descname">open_event</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#open_event"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.open_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Opens an event retrieved from Karabo at XFEL.</p>
<p>Karabo events do not need to be opened. As soon as an event is retrieved, its
content is made available in the ‘data’ field of the ‘event’ object. This function
actually does nothing.</p>
<p>NOTE: This function is designed to be injected as a member function into an
<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a> object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>event</strong> (<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a>) – an object storing the event
data.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.close_event">
<code class="descname">close_event</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#close_event"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.close_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Closes an event retrieved from Karabo at XFEL.</p>
<p>Karabo events do not need to be closed, so this function actually does nothing.</p>
<p>NOTE: This function is designed to be injected as a member function into an
<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a> object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>event</strong> (<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a>) – an object storing the event
data.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.timestamp">
<code class="descname">timestamp</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#timestamp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.timestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the timestamp of an event retrieved from Karabo at XFEL.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>event</strong> (<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a>) – an object storing the event
data.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the timestamp of the event  in seconds from the Epoch.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">numpy.float64</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.optical_laser_active">
<code class="descname">optical_laser_active</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#optical_laser_active"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.optical_laser_active" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves from Karabo the status of the optical laser at XFEL.</p>
<p>Returns whether, in pump probe experiments, the optical laser is active for the
current frame. Currently Karabo provides no information about the status of
optical lasers at XFEL. Hence, this function determines the status of the laser
according to information provided in the OnDA configuration file.</p>
<ul class="simple">
<li>The file must include a entry called ‘karabo_frame_ids_with_optical_laser_active’
in the ‘DataRetrievalLayer’ parameter group.</li>
<li>The entry must contain a list of frame indexes for which the optical laser is
supposed to be active.</li>
<li>If the index of the current frame within the event is included in the list, the
optical laser is considered to be active.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>event</strong> (<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a>) – an object storing the event
data.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if the optical laser is active, False otherwise.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.xrays_active">
<code class="descname">xrays_active</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#xrays_active"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.xrays_active" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves from Karabo the status of the x-ray beam at XFEL.</p>
<p>Returns whether the x-ray beam is active for the current frame. Currently Karabo
provides no information about the status of the x-ray beam at XFEL. Hence, this
function determines the status of the beam according to information provided in the
OnDA configuration file.</p>
<ul class="simple">
<li>The file must include a entry called ‘karabo_frame_ids_with_xrays_active’
in the ‘DataRetrievalLayer’ parameter group.</li>
<li>The entry must contain a list of frame indexes for which the x-ray beam is
supposed to be active.</li>
<li>If the index of the current frame within the event is included in the list, the
x-ray beam is considered to be active.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>event</strong> (<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a>) – an object storing the event
data.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if the x-ray beam is active, False otherwise.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.event_id">
<code class="descname">event_id</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#event_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.event_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves a unique identifier for an event retrieved from Karabo at XFEL.</p>
<p>Returns a label that unambiguosly identifies, within an experiment, the event
currently being processed. At the European XFEL facility, an event corresponds to a
pulse train and the train id is used as identifier.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>event</strong> (<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a>) – an object storing the event
data.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a unique event identifier.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.frame_id">
<code class="descname">frame_id</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#frame_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.frame_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets a unique identifier for a data frame retrieved from Karabo at XFEL.</p>
<p>Returns a label that unambiguosly identifies, within an event, the frame currently
being processed. At the European XFEL facility, the index of the frame within its
train is used as identifier.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>event</strong> (<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a>) – an object storing the event
data.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a unique frame identifier (within an event).</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.beam_energy">
<code class="descname">beam_energy</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#beam_energy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.beam_energy" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the beam energy for an event retrieved from Karabo at XFEL.</p>
<p>Karabo events do not currently contain beam energy information. This function takes
it from the configuration file, specifically from the
‘fallback_beam_energy_in_eV’ entry in the ‘DataRetrievalLayer’ parameter
group.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>event</strong> (<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a>) – an object storing the event
data.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the energy of the beam in eV.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="onda.data_retrieval_layer.frameworks.karabo_euxfel.detector_distance">
<code class="descname">detector_distance</code><span class="sig-paren">(</span><em>event</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/onda/data_retrieval_layer/frameworks/karabo_euxfel.html#detector_distance"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#onda.data_retrieval_layer.frameworks.karabo_euxfel.detector_distance" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the detector distance for an event retrieved from Karabo at XFEL.</p>
<p>Karabo events don’t currently contain detector distance information. This function
takes it from the configuration file, specifically from the
‘fallback_detector_distance_in_mm’ entry in the ‘DataRetrievalLayer’
parameter group.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>event</strong> (<a class="reference internal" href="onda.utils.data_event.html#onda.utils.data_event.DataEvent" title="onda.utils.data_event.DataEvent"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataEvent</span></code></a>) – an object storing the event
data.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the detector distance in mm.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">float</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 
    2014-2019 Deutsches Elektronen-Synchrotron DESY, a research centre of
    the Helmholtz Association
.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>