<!DOCTYPE html>
<!-- Generated by Cython 3.0.8 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: _crystallography.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { color: #000000; margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 3.0.8</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="_crystallography.cpp">_crystallography.cpp</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: # This file is part of OM.</pre>
<pre class='cython code score-8 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: # OM is free software: you can redistribute it and/or modify it under the terms of</pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: # the GNU General Public License as published by the Free Software Foundation, either</pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: # version 3 of the License, or (at your option) any later version.</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: # OM is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: # without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: # PURPOSE.  See the GNU General Public License for more details.</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: # You should have received a copy of the GNU General Public License along with OnDA.</pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: # If not, see &lt;http://www.gnu.org/licenses/&gt;.</pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: # Copyright 2020 -2023 SLAC National Accelerator Laboratory</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: # Based on OnDA - Copyright 2014-2019 Deutsches Elektronen-Synchrotron DESY,</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: # a research centre of the Helmholtz Association.</pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: """</pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: Peakfinder8 extension.</pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: This extension contains an implementation of Cheetah's 'peakfinder8' peak detection</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: algorithm.</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: """</pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: from libcpp.vector cimport vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: from libc.stdlib cimport malloc, free</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: from libc.stdint cimport int8_t</pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">028</span>: import numpy</pre>
<pre class='cython code score-8 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportDottedModule</span>(__pyx_n_s_numpy, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_numpy, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 28, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">029</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: cdef extern from "peakfinder8.hh":</pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>:     ctypedef struct tPeakList:</pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>:         long	    nPeaks</pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>:         long	    nHot</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>:         float		peakResolution</pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>:         float		peakResolutionA</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>:         float		peakDensity</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>:         float		peakNpix</pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>:         float		peakTotal</pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>:         int			memoryAllocated</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>:         long		nPeaks_max</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>:         float       *peak_maxintensity</pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>:         float       *peak_totalintensity</pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>:         float       *peak_sigma</pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>:         float       *peak_snr</pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>:         float       *peak_npix</pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>:         float       *peak_com_x</pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>:         float       *peak_com_y</pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>:         long        *peak_com_index</pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>:         float       *peak_com_x_assembled</pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>:         float       *peak_com_y_assembled</pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>:         float       *peak_com_r_assembled</pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>:         float       *peak_com_q</pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>:         float       *peak_com_res</pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>:     void allocatePeakList(tPeakList* peak_list, long max_num_peaks)</pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>:     void freePeakList(tPeakList peak_list)</pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>: cdef extern from "peakfinder8.hh":</pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>:     int peakfinder8(tPeakList *peaklist, float *data, char *mask, float *pix_r,</pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>:                     int rstats_num_pix, int *rstats_pidx, int *rstats_radius, int fast,</pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>:                     long asic_nx, long asic_ny, long nasics_x, long nasics_y,</pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>:                     float ADCthresh, float hitfinderMinSNR,</pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:                     long hitfinderMinPixCount, long hitfinderMaxPixCount,</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>:                     long hitfinderLocalBGRadius, char* outliersMask);</pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>: </pre>
<pre class="cython line score-437" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">070</span>: def peakfinder_8(int max_num_peaks, float[:,::1] data, char[:,::1] mask,</pre>
<pre class='cython code score-437 '>static PyObject *__pyx_pf_2om_10algorithms_16_crystallography_4__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_memoryview_fromslice(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self)-&gt;__pyx_arg_outlier_mask, 2, (PyObject *(*)(char *)) __pyx_memview_get_char, (int (*)(char *, PyObject *)) __pyx_memview_set_char, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 70, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 70, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 70, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='refnanny'>__Pyx_GIVEREF</span>(Py_None);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_1, 1, Py_None)) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>;
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("om.algorithms._crystallography.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_2om_10algorithms_16_crystallography_1peakfinder_8(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_2om_10algorithms_16_crystallography_peakfinder_8, "\n    peakfinder_8(max_num_peaks, data, mask, pix_r, asic_nx, asic_ny, nasics_x,         nasics_y, adc_thresh, hitfinder_min_snr, hitfinder_min_pix_count,         hitfinder_max_pix_count, hitfinder_local_bg_radius)\n    \n    Peakfinder8 peak detection.\n\n    This function finds peaks in a detector data frame using the 'peakfinder8'\n    strategy from the Cheetah software package. The 'peakfinder8' peak detection\n    strategy is described in the following publication:\n\n    A. Barty, R. A. Kirian, F. R. N. C. Maia, M. Hantke, C. H. Yoon, T. A. White,\n    and H. N. Chapman, \"Cheetah: software for high-throughput reduction and\n    analysis of serial femtosecond x-ray diffraction data\", J Appl  Crystallogr,\n    vol. 47, pp. 1118-1131 (2014).\n\n    Arguments:\n\n        max_num_peaks (:obj:`int`): The maximum number of peaks that will be retrieved\n            from each data frame. Additional peaks will be ignored.\n\n        data (:obj:`numpy.ndarray`): The detector data frame on which the peak finding\n            must be performed (as an numpy array of float32).\n\n        mask (:obj:`numpy.ndarray`): A numpy array of int8 storing a mask.  The map can\n            be used to mark areas of the data frame that must be excluded from the peak\n            search. \n\n            * The map must be a numpy array of the same shape as the data frame on\n              which the algorithm will be applied.\n\n            * Each pixel in the map must have a value of either 0, meaning that\n              the corresponding pixel in the data frame should be ignored, or 1,\n              meaning that the corresponding pixel should be included in the\n              search.\n\n            * The map is only used to exclude areas from the peak search: the data\n              is not modified in any way.\n\n        pix_r (:obj:`numpy.ndarray`): A numpy array of float32 with radius information.\n\n            * The array must have the same shape as the data frame on which the\n   ""           algorithm will be applied.\n\n            * Each element of the array must store, for the corresponding pixel in the\n              data frame, the distance in pixels from the origin of the detector\n              reference system (usually the center of the detector).\n\n        asic_nx (:obj:`int`):: The fs size in pixels of each detector panel in the data\n            frame.\n\n        asic_ny (:obj:`int`):: The ss size in pixels of each detector panel in the data\n            frame.\n\n        nasics_x (:obj:`int`): The number of panels along the fs axis of the data\n            frame.\n\n        nasics_y (:obj:`int`): The number of panels along the ss axis of the data\n            frame.\n\n        adc_thresh (:obj:`float`):: The minimum ADC threshold for peak detection.\n\n        hitfinder_min_snr (:obj:`float`): The minimum signal-to-noise ratio for peak\n            detection.\n\n        hitfinder_min_pix_count (:obj:`int`): The minimum size of a peak in pixels.\n\n        hitfinder_max_pixel_count (:obj:`int`): The maximum size of a peak in pixels.\n\n        local_bg_radius: The radius for the estimation of the local background in\n            pixels.\n\n        outliers (:obj:`numpy.ndarray`): This argument must have a value of None, or\n            one corresponding to an array of the same size and shape as the array\n            storing the detector data on which the peak finding is performed, set up to\n            store int8 values. If the value of this argument corresponds to such an\n            array, the array is modified during the function call, to store the\n            internal \"outliers\" pixel classification mask generated by the peakfinder8\n            algorithm.\n\n             * After the function returns, each pixel in the array stores the\n               classification information for the corresponding pixel in the detector\n               data array.\n\n            If the value of this argument is None, no information is r""eturned.\n\n    Returns:\n\n        :obj:`Tuple[int, List[float], List[float], List[float], List[float], List[float], List[float]`: A tuple storing  information about the detected peaks. The\n        tuple has the following elements:\n\n            * The first entry stores the number of peaks that were detected in the data\n            frame.\n\n            * The second entry is a list storing the fractional fs indexes that locate\n            thedetected peaks in the data frame.\n    \n            * The third entry is a list storing the fractional ss indexes that locate the\n            the detected peaks in the data frame.\n    \n            * The fourth entry is a list storing the integrated intensities for the\n            detected peaks.\n    \n            * The fifth entry is a list storing the number of pixels that make up each\n            detected peak.\n\n            * The sixth entry is a list storing, for each peak, the value of the pixel\n            with the maximum intensity.\n    \n            * The seventh entry is a list storing the signal-to-noise ratio of each\n            detected peak.\n    ");
static PyMethodDef __pyx_mdef_2om_10algorithms_16_crystallography_1peakfinder_8 = {"peakfinder_8", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_2om_10algorithms_16_crystallography_1peakfinder_8, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_2om_10algorithms_16_crystallography_peakfinder_8};
static PyObject *__pyx_pw_2om_10algorithms_16_crystallography_1peakfinder_8(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  int __pyx_v_max_num_peaks;
  __Pyx_memviewslice __pyx_v_data = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_pix_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_rstats_num_pix;
  __Pyx_memviewslice __pyx_v_rstats_pidx = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_rstats_radius = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_fast;
  long __pyx_v_asic_nx;
  long __pyx_v_asic_ny;
  long __pyx_v_nasics_x;
  long __pyx_v_nasics_y;
  float __pyx_v_adc_thresh;
  float __pyx_v_hitfinder_min_snr;
  long __pyx_v_hitfinder_min_pix_count;
  long __pyx_v_hitfinder_max_pix_count;
  long __pyx_v_hitfinder_local_bg_radius;
  __Pyx_memviewslice __pyx_v_outlier_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("peakfinder_8 (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_max_num_peaks,&amp;__pyx_n_s_data,&amp;__pyx_n_s_mask,&amp;__pyx_n_s_pix_r,&amp;__pyx_n_s_rstats_num_pix,&amp;__pyx_n_s_rstats_pidx,&amp;__pyx_n_s_rstats_radius,&amp;__pyx_n_s_fast,&amp;__pyx_n_s_asic_nx,&amp;__pyx_n_s_asic_ny,&amp;__pyx_n_s_nasics_x,&amp;__pyx_n_s_nasics_y,&amp;__pyx_n_s_adc_thresh,&amp;__pyx_n_s_hitfinder_min_snr,&amp;__pyx_n_s_hitfinder_min_pix_count,&amp;__pyx_n_s_hitfinder_max_pix_count,&amp;__pyx_n_s_hitfinder_local_bg_radius,&amp;__pyx_n_s_outlier_mask,0};
  PyObject* values[18] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    __pyx_defaults *__pyx_dynamic_args = <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self);
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case 18: values[17] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_max_num_peaks)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 1); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_mask)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 2); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_pix_r)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[3]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 3); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_rstats_num_pix)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[4]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 4); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_rstats_pidx)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[5]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 5); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_rstats_radius)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[6]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 6); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_fast)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[7]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 7); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_asic_nx)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[8]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 8); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_asic_ny)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[9]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 9); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_nasics_x)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[10]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 10); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_nasics_y)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[11]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 11); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_adc_thresh)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[12]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 12); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_hitfinder_min_snr)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[13]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 13); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_hitfinder_min_pix_count)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[14]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 14); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_hitfinder_max_pix_count)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[15]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 15); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (likely((values[16] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_hitfinder_local_bg_radius)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[16]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, 16); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_outlier_mask);
          if (value) { values[17] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "peakfinder_8") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case 18: values[17] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 16);
        values[15] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 15);
        values[14] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 14);
        values[13] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 13);
        values[12] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 12);
        values[11] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 11);
        values[10] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 10);
        values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);
        values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);
        values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);
        values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);
        values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_max_num_peaks = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[0]); if (unlikely((__pyx_v_max_num_peaks == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
    __pyx_v_data = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_float</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 70, __pyx_L3_error)</span>
    __pyx_v_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_char</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_mask.memview)) __PYX_ERR(0, 70, __pyx_L3_error)</span>
    __pyx_v_pix_r = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_float</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_pix_r.memview)) __PYX_ERR(0, 71, __pyx_L3_error)</span>
    __pyx_v_rstats_num_pix = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[4]); if (unlikely((__pyx_v_rstats_num_pix == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L3_error)</span>
    __pyx_v_rstats_pidx = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_rstats_pidx.memview)) __PYX_ERR(0, 71, __pyx_L3_error)</span>
    __pyx_v_rstats_radius = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_rstats_radius.memview)) __PYX_ERR(0, 72, __pyx_L3_error)</span>
    __pyx_v_fast = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[7]); if (unlikely((__pyx_v_fast == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 72, __pyx_L3_error)</span>
    __pyx_v_asic_nx = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[8]); if (unlikely((__pyx_v_asic_nx == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 72, __pyx_L3_error)</span>
    __pyx_v_asic_ny = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[9]); if (unlikely((__pyx_v_asic_ny == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 72, __pyx_L3_error)</span>
    __pyx_v_nasics_x = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[10]); if (unlikely((__pyx_v_nasics_x == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 73, __pyx_L3_error)</span>
    __pyx_v_nasics_y = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[11]); if (unlikely((__pyx_v_nasics_y == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 73, __pyx_L3_error)</span>
    __pyx_v_adc_thresh = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[12]); if (unlikely((__pyx_v_adc_thresh == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 73, __pyx_L3_error)</span>
    __pyx_v_hitfinder_min_snr = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[13]); if (unlikely((__pyx_v_hitfinder_min_snr == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 74, __pyx_L3_error)</span>
    __pyx_v_hitfinder_min_pix_count = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[14]); if (unlikely((__pyx_v_hitfinder_min_pix_count == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 74, __pyx_L3_error)</span>
    __pyx_v_hitfinder_max_pix_count = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[15]); if (unlikely((__pyx_v_hitfinder_max_pix_count == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 75, __pyx_L3_error)</span>
    __pyx_v_hitfinder_local_bg_radius = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[16]); if (unlikely((__pyx_v_hitfinder_local_bg_radius == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 75, __pyx_L3_error)</span>
    if (values[17]) {
      __pyx_v_outlier_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_char</span>(values[17], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_outlier_mask.memview)) __PYX_ERR(0, 76, __pyx_L3_error)</span>
    } else {
      __pyx_v_outlier_mask = __pyx_dynamic_args-&gt;__pyx_arg_outlier_mask;
      __PYX_INC_MEMVIEW(&amp;__pyx_v_outlier_mask, 1);
    }
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8", 0, 17, 18, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_mask, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_pix_r, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_rstats_pidx, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_rstats_radius, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_outlier_mask, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("om.algorithms._crystallography.peakfinder_8", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_2om_10algorithms_16_crystallography_peakfinder_8(__pyx_self, __pyx_v_max_num_peaks, __pyx_v_data, __pyx_v_mask, __pyx_v_pix_r, __pyx_v_rstats_num_pix, __pyx_v_rstats_pidx, __pyx_v_rstats_radius, __pyx_v_fast, __pyx_v_asic_nx, __pyx_v_asic_ny, __pyx_v_nasics_x, __pyx_v_nasics_y, __pyx_v_adc_thresh, __pyx_v_hitfinder_min_snr, __pyx_v_hitfinder_min_pix_count, __pyx_v_hitfinder_max_pix_count, __pyx_v_hitfinder_local_bg_radius, __pyx_v_outlier_mask);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_mask, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_pix_r, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_rstats_pidx, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_rstats_radius, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_outlier_mask, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_2om_10algorithms_16_crystallography_peakfinder_8(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_max_num_peaks, __Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_mask, __Pyx_memviewslice __pyx_v_pix_r, int __pyx_v_rstats_num_pix, __Pyx_memviewslice __pyx_v_rstats_pidx, __Pyx_memviewslice __pyx_v_rstats_radius, int __pyx_v_fast, long __pyx_v_asic_nx, long __pyx_v_asic_ny, long __pyx_v_nasics_x, long __pyx_v_nasics_y, float __pyx_v_adc_thresh, float __pyx_v_hitfinder_min_snr, long __pyx_v_hitfinder_min_pix_count, long __pyx_v_hitfinder_max_pix_count, long __pyx_v_hitfinder_local_bg_radius, __Pyx_memviewslice __pyx_v_outlier_mask) {
  tPeakList __pyx_v_peak_list;
  int __pyx_v_i;
  float __pyx_v_peak_x;
  float __pyx_v_peak_y;
  float __pyx_v_peak_value;
  std::vector&lt;double&gt;  __pyx_v_peak_list_x;
  std::vector&lt;double&gt;  __pyx_v_peak_list_y;
  std::vector&lt;long&gt;  __pyx_v_peak_list_index;
  std::vector&lt;double&gt;  __pyx_v_peak_list_value;
  std::vector&lt;double&gt;  __pyx_v_peak_list_npix;
  std::vector&lt;double&gt;  __pyx_v_peak_list_maxi;
  std::vector&lt;double&gt;  __pyx_v_peak_list_sigma;
  std::vector&lt;double&gt;  __pyx_v_peak_list_snr;
  long __pyx_v_num_peaks;
  long __pyx_v_peak_index;
  float __pyx_v_peak_npix;
  float __pyx_v_peak_maxi;
  float __pyx_v_peak_sigma;
  float __pyx_v_peak_snr;
  PyObject *__pyx_r = NULL;
/*  */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_21);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_23);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("om.algorithms._crystallography.peakfinder_8", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/*  */
  __pyx_tuple__20 = <span class='py_c_api'>PyTuple_Pack</span>(37, __pyx_n_s_max_num_peaks, __pyx_n_s_data, __pyx_n_s_mask, __pyx_n_s_pix_r, __pyx_n_s_rstats_num_pix, __pyx_n_s_rstats_pidx, __pyx_n_s_rstats_radius, __pyx_n_s_fast, __pyx_n_s_asic_nx, __pyx_n_s_asic_ny, __pyx_n_s_nasics_x, __pyx_n_s_nasics_y, __pyx_n_s_adc_thresh, __pyx_n_s_hitfinder_min_snr, __pyx_n_s_hitfinder_min_pix_count, __pyx_n_s_hitfinder_max_pix_count, __pyx_n_s_hitfinder_local_bg_radius, __pyx_n_s_outlier_mask, __pyx_n_s_peak_list, __pyx_n_s_i, __pyx_n_s_peak_x, __pyx_n_s_peak_y, __pyx_n_s_peak_value, __pyx_n_s_peak_list_x, __pyx_n_s_peak_list_y, __pyx_n_s_peak_list_index, __pyx_n_s_peak_list_value, __pyx_n_s_peak_list_npix, __pyx_n_s_peak_list_maxi, __pyx_n_s_peak_list_sigma, __pyx_n_s_peak_list_snr, __pyx_n_s_num_peaks, __pyx_n_s_peak_index, __pyx_n_s_peak_npix, __pyx_n_s_peak_maxi, __pyx_n_s_peak_sigma, __pyx_n_s_peak_snr);<span class='error_goto'> if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 70, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__20);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__20);
/*  */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_2om_10algorithms_16_crystallography_1peakfinder_8, 0, __pyx_n_s_peakfinder_8, NULL, __pyx_n_s_om_algorithms__crystallography, __pyx_d, ((PyObject *)__pyx_codeobj__21));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 70, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (!<span class='pyx_c_api'>__Pyx_CyFunction_InitDefaults</span>(__pyx_t_7, sizeof(__pyx_defaults), 0)) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>
  __pyx_codeobj__21 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(18, 0, 0, 37, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__20, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cython__crystallography_pyx, __pyx_n_s_peakfinder_8, 70, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__21)) __PYX_ERR(0, 70, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">071</span>:                  float[:,::1] pix_r, int rstats_num_pix, int[:] rstats_pidx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:                  int[:] rstats_radius, int fast, long asic_nx, long asic_ny,</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:                  long nasics_x, long nasics_y, float adc_thresh,</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:                  float hitfinder_min_snr, long hitfinder_min_pix_count,</pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:                  long hitfinder_max_pix_count, long hitfinder_local_bg_radius,</pre>
<pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">076</span>:                  char[:,::1] outlier_mask = None):</pre>
<pre class='cython code score-12 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_char</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 76, __pyx_L1_error)</span>
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_t_7)-&gt;__pyx_arg_outlier_mask = __pyx_t_9;
  __pyx_t_9.memview = NULL;
  __pyx_t_9.data = NULL;
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsGetter</span>(__pyx_t_7, __pyx_pf_2om_10algorithms_16_crystallography_4__defaults__);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_peakfinder_8, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">077</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:     peakfinder_8(max_num_peaks, data, mask, pix_r, asic_nx, asic_ny, nasics_x, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:         nasics_y, adc_thresh, hitfinder_min_snr, hitfinder_min_pix_count, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>:         hitfinder_max_pix_count, hitfinder_local_bg_radius)</pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:     Peakfinder8 peak detection.</pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>:     This function finds peaks in a detector data frame using the 'peakfinder8'</pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>:     strategy from the Cheetah software package. The 'peakfinder8' peak detection</pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>:     strategy is described in the following publication:</pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>:     A. Barty, R. A. Kirian, F. R. N. C. Maia, M. Hantke, C. H. Yoon, T. A. White,</pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>:     and H. N. Chapman, "Cheetah: software for high-throughput reduction and</pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>:     analysis of serial femtosecond x-ray diffraction data", J Appl  Crystallogr,</pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>:     vol. 47, pp. 1118-1131 (2014).</pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>:     Arguments:</pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">095</span>:         max_num_peaks (:obj:`int`): The maximum number of peaks that will be retrieved</pre>
<pre class="cython line score-0">&#xA0;<span class="">096</span>:             from each data frame. Additional peaks will be ignored.</pre>
<pre class="cython line score-0">&#xA0;<span class="">097</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">098</span>:         data (:obj:`numpy.ndarray`): The detector data frame on which the peak finding</pre>
<pre class="cython line score-0">&#xA0;<span class="">099</span>:             must be performed (as an numpy array of float32).</pre>
<pre class="cython line score-0">&#xA0;<span class="">100</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>:         mask (:obj:`numpy.ndarray`): A numpy array of int8 storing a mask.  The map can</pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>:             be used to mark areas of the data frame that must be excluded from the peak</pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>:             search.</pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>:             * The map must be a numpy array of the same shape as the data frame on</pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>:               which the algorithm will be applied.</pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>:             * Each pixel in the map must have a value of either 0, meaning that</pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>:               the corresponding pixel in the data frame should be ignored, or 1,</pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>:               meaning that the corresponding pixel should be included in the</pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>:               search.</pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>:             * The map is only used to exclude areas from the peak search: the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>:               is not modified in any way.</pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>:         pix_r (:obj:`numpy.ndarray`): A numpy array of float32 with radius information.</pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>:             * The array must have the same shape as the data frame on which the</pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>:               algorithm will be applied.</pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>:             * Each element of the array must store, for the corresponding pixel in the</pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>:               data frame, the distance in pixels from the origin of the detector</pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:               reference system (usually the center of the detector).</pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:         asic_nx (:obj:`int`):: The fs size in pixels of each detector panel in the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:         asic_ny (:obj:`int`):: The ss size in pixels of each detector panel in the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>:         nasics_x (:obj:`int`): The number of panels along the fs axis of the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>:         nasics_y (:obj:`int`): The number of panels along the ss axis of the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>:         adc_thresh (:obj:`float`):: The minimum ADC threshold for peak detection.</pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>:         hitfinder_min_snr (:obj:`float`): The minimum signal-to-noise ratio for peak</pre>
<pre class="cython line score-0">&#xA0;<span class="">140</span>:             detection.</pre>
<pre class="cython line score-0">&#xA0;<span class="">141</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>:         hitfinder_min_pix_count (:obj:`int`): The minimum size of a peak in pixels.</pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>:         hitfinder_max_pixel_count (:obj:`int`): The maximum size of a peak in pixels.</pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>:         local_bg_radius: The radius for the estimation of the local background in</pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:             pixels.</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>:         outliers (:obj:`numpy.ndarray`): This argument must have a value of None, or</pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>:             one corresponding to an array of the same size and shape as the array</pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>:             storing the detector data on which the peak finding is performed, set up to</pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>:             store int8 values. If the value of this argument corresponds to such an</pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:             array, the array is modified during the function call, to store the</pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>:             internal "outliers" pixel classification mask generated by the peakfinder8</pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>:             algorithm.</pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>:              * After the function returns, each pixel in the array stores the</pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>:                classification information for the corresponding pixel in the detector</pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:                data array.</pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>:             If the value of this argument is None, no information is returned.</pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>:     Returns:</pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>:         :obj:`Tuple[int, List[float], List[float], List[float], List[float], \</pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>: List[float], List[float]`: A tuple storing  information about the detected peaks. The</pre>
<pre class="cython line score-0">&#xA0;<span class="">167</span>:         tuple has the following elements:</pre>
<pre class="cython line score-0">&#xA0;<span class="">168</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">169</span>:             * The first entry stores the number of peaks that were detected in the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">170</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">171</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>:             * The second entry is a list storing the fractional fs indexes that locate</pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>:             thedetected peaks in the data frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>:             * The third entry is a list storing the fractional ss indexes that locate the</pre>
<pre class="cython line score-0">&#xA0;<span class="">176</span>:             the detected peaks in the data frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">177</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>:             * The fourth entry is a list storing the integrated intensities for the</pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>:             detected peaks.</pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>:             * The fifth entry is a list storing the number of pixels that make up each</pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>:             detected peak.</pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>:             * The sixth entry is a list storing, for each peak, the value of the pixel</pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>:             with the maximum intensity.</pre>
<pre class="cython line score-0">&#xA0;<span class="">186</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>:             * The seventh entry is a list storing the signal-to-noise ratio of each</pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>:             detected peak.</pre>
<pre class="cython line score-0">&#xA0;<span class="">189</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">190</span>:     cdef tPeakList peak_list</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>:     allocatePeakList(&amp;peak_list, max_num_peaks)</pre>
<pre class='cython code score-0 '>  allocatePeakList((&amp;__pyx_v_peak_list), __pyx_v_max_num_peaks);
</pre><pre class="cython line score-0">&#xA0;<span class="">192</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">193</span>:     if outlier_mask is None:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (((PyObject *) __pyx_v_outlier_mask.memview) == Py_None);
  if (__pyx_t_1) {
/*  */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">194</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:         peakfinder8(&amp;peak_list, &amp;data[0, 0], &amp;mask[0,0], &amp;pix_r[0, 0], rstats_num_pix,</pre>
<pre class='cython code score-6 '>    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_4 = -1;
    if (__pyx_t_2 &lt; 0) {
      __pyx_t_2 += __pyx_v_data.shape[0];
      if (unlikely(__pyx_t_2 &lt; 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_2 &gt;= __pyx_v_data.shape[0])) __pyx_t_4 = 0;
    if (__pyx_t_3 &lt; 0) {
      __pyx_t_3 += __pyx_v_data.shape[1];
      if (unlikely(__pyx_t_3 &lt; 0)) __pyx_t_4 = 1;
    } else if (unlikely(__pyx_t_3 &gt;= __pyx_v_data.shape[1])) __pyx_t_4 = 1;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
      <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L1_error)</span>
    }
    __pyx_t_5 = 0;
    __pyx_t_6 = 0;
    __pyx_t_4 = -1;
    if (__pyx_t_5 &lt; 0) {
      __pyx_t_5 += __pyx_v_mask.shape[0];
      if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_mask.shape[0])) __pyx_t_4 = 0;
    if (__pyx_t_6 &lt; 0) {
      __pyx_t_6 += __pyx_v_mask.shape[1];
      if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_4 = 1;
    } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_mask.shape[1])) __pyx_t_4 = 1;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
      <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L1_error)</span>
    }
    __pyx_t_7 = 0;
    __pyx_t_8 = 0;
    __pyx_t_4 = -1;
    if (__pyx_t_7 &lt; 0) {
      __pyx_t_7 += __pyx_v_pix_r.shape[0];
      if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_pix_r.shape[0])) __pyx_t_4 = 0;
    if (__pyx_t_8 &lt; 0) {
      __pyx_t_8 += __pyx_v_pix_r.shape[1];
      if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_4 = 1;
    } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_pix_r.shape[1])) __pyx_t_4 = 1;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
      <span class='error_goto'>__PYX_ERR(0, 195, __pyx_L1_error)</span>
    }
/*  */
    (void)(peakfinder8((&amp;__pyx_v_peak_list), (&amp;(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_2 * __pyx_v_data.strides[0]) )) + __pyx_t_3)) )))), (&amp;(*((char *) ( /* dim=1 */ ((char *) (((char *) ( /* dim=0 */ (__pyx_v_mask.data + __pyx_t_5 * __pyx_v_mask.strides[0]) )) + __pyx_t_6)) )))), (&amp;(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_pix_r.data + __pyx_t_7 * __pyx_v_pix_r.strides[0]) )) + __pyx_t_8)) )))), __pyx_v_rstats_num_pix, __pyx_t_9, __pyx_t_11, __pyx_v_fast, __pyx_v_asic_nx, __pyx_v_asic_ny, __pyx_v_nasics_x, __pyx_v_nasics_y, __pyx_v_adc_thresh, __pyx_v_hitfinder_min_snr, __pyx_v_hitfinder_min_pix_count, __pyx_v_hitfinder_max_pix_count, __pyx_v_hitfinder_local_bg_radius, NULL));
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:                     &amp;rstats_pidx[0] if rstats_pidx is not None else NULL,</pre>
<pre class='cython code score-2 '>    __pyx_t_1 = (((PyObject *) __pyx_v_rstats_pidx.memview) != Py_None);
    if (__pyx_t_1) {
      __pyx_t_10 = 0;
      __pyx_t_4 = -1;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_rstats_pidx.shape[0];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_4 = 0;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_rstats_pidx.shape[0])) __pyx_t_4 = 0;
      if (unlikely(__pyx_t_4 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
        <span class='error_goto'>__PYX_ERR(0, 196, __pyx_L1_error)</span>
      }
      __pyx_t_9 = (&amp;(*((int *) ( /* dim=0 */ (__pyx_v_rstats_pidx.data + __pyx_t_10 * __pyx_v_rstats_pidx.strides[0]) ))));
    } else {
      __pyx_t_9 = NULL;
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:                     &amp;rstats_radius[0] if rstats_radius is not None else NULL,</pre>
<pre class='cython code score-2 '>    __pyx_t_1 = (((PyObject *) __pyx_v_rstats_radius.memview) != Py_None);
    if (__pyx_t_1) {
      __pyx_t_10 = 0;
      __pyx_t_4 = -1;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_rstats_radius.shape[0];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_4 = 0;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_rstats_radius.shape[0])) __pyx_t_4 = 0;
      if (unlikely(__pyx_t_4 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
        <span class='error_goto'>__PYX_ERR(0, 197, __pyx_L1_error)</span>
      }
      __pyx_t_11 = (&amp;(*((int *) ( /* dim=0 */ (__pyx_v_rstats_radius.data + __pyx_t_10 * __pyx_v_rstats_radius.strides[0]) ))));
    } else {
      __pyx_t_11 = NULL;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">198</span>:                     fast, asic_nx, asic_ny, nasics_x, nasics_y, adc_thresh,</pre>
<pre class="cython line score-0">&#xA0;<span class="">199</span>:                     hitfinder_min_snr, hitfinder_min_pix_count, hitfinder_max_pix_count,</pre>
<pre class="cython line score-0">&#xA0;<span class="">200</span>:                     hitfinder_local_bg_radius, NULL)</pre>
<pre class="cython line score-0">&#xA0;<span class="">201</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">202</span>:     else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">203</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:         peakfinder8(&amp;peak_list, &amp;data[0, 0], &amp;mask[0,0], &amp;pix_r[0, 0], rstats_num_pix,</pre>
<pre class='cython code score-6 '>  /*else*/ {
    __pyx_t_8 = 0;
    __pyx_t_7 = 0;
    __pyx_t_4 = -1;
    if (__pyx_t_8 &lt; 0) {
      __pyx_t_8 += __pyx_v_data.shape[0];
      if (unlikely(__pyx_t_8 &lt; 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_8 &gt;= __pyx_v_data.shape[0])) __pyx_t_4 = 0;
    if (__pyx_t_7 &lt; 0) {
      __pyx_t_7 += __pyx_v_data.shape[1];
      if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_4 = 1;
    } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_data.shape[1])) __pyx_t_4 = 1;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
      <span class='error_goto'>__PYX_ERR(0, 204, __pyx_L1_error)</span>
    }
    __pyx_t_6 = 0;
    __pyx_t_5 = 0;
    __pyx_t_4 = -1;
    if (__pyx_t_6 &lt; 0) {
      __pyx_t_6 += __pyx_v_mask.shape[0];
      if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_mask.shape[0])) __pyx_t_4 = 0;
    if (__pyx_t_5 &lt; 0) {
      __pyx_t_5 += __pyx_v_mask.shape[1];
      if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_4 = 1;
    } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_mask.shape[1])) __pyx_t_4 = 1;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
      <span class='error_goto'>__PYX_ERR(0, 204, __pyx_L1_error)</span>
    }
    __pyx_t_3 = 0;
    __pyx_t_2 = 0;
    __pyx_t_4 = -1;
    if (__pyx_t_3 &lt; 0) {
      __pyx_t_3 += __pyx_v_pix_r.shape[0];
      if (unlikely(__pyx_t_3 &lt; 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_3 &gt;= __pyx_v_pix_r.shape[0])) __pyx_t_4 = 0;
    if (__pyx_t_2 &lt; 0) {
      __pyx_t_2 += __pyx_v_pix_r.shape[1];
      if (unlikely(__pyx_t_2 &lt; 0)) __pyx_t_4 = 1;
    } else if (unlikely(__pyx_t_2 &gt;= __pyx_v_pix_r.shape[1])) __pyx_t_4 = 1;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
      <span class='error_goto'>__PYX_ERR(0, 204, __pyx_L1_error)</span>
    }
/*  */
    (void)(peakfinder8((&amp;__pyx_v_peak_list), (&amp;(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_8 * __pyx_v_data.strides[0]) )) + __pyx_t_7)) )))), (&amp;(*((char *) ( /* dim=1 */ ((char *) (((char *) ( /* dim=0 */ (__pyx_v_mask.data + __pyx_t_6 * __pyx_v_mask.strides[0]) )) + __pyx_t_5)) )))), (&amp;(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_pix_r.data + __pyx_t_3 * __pyx_v_pix_r.strides[0]) )) + __pyx_t_2)) )))), __pyx_v_rstats_num_pix, __pyx_t_11, __pyx_t_9, __pyx_v_fast, __pyx_v_asic_nx, __pyx_v_asic_ny, __pyx_v_nasics_x, __pyx_v_nasics_y, __pyx_v_adc_thresh, __pyx_v_hitfinder_min_snr, __pyx_v_hitfinder_min_pix_count, __pyx_v_hitfinder_max_pix_count, __pyx_v_hitfinder_local_bg_radius, (&amp;(*((char *) ( /* dim=1 */ ((char *) (((char *) ( /* dim=0 */ (__pyx_v_outlier_mask.data + __pyx_t_10 * __pyx_v_outlier_mask.strides[0]) )) + __pyx_t_12)) ))))));
  }
  __pyx_L3:;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">205</span>:                     &amp;rstats_pidx[0] if rstats_pidx is not None else NULL,</pre>
<pre class='cython code score-2 '>    __pyx_t_1 = (((PyObject *) __pyx_v_rstats_pidx.memview) != Py_None);
    if (__pyx_t_1) {
      __pyx_t_10 = 0;
      __pyx_t_4 = -1;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_rstats_pidx.shape[0];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_4 = 0;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_rstats_pidx.shape[0])) __pyx_t_4 = 0;
      if (unlikely(__pyx_t_4 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
        <span class='error_goto'>__PYX_ERR(0, 205, __pyx_L1_error)</span>
      }
      __pyx_t_11 = (&amp;(*((int *) ( /* dim=0 */ (__pyx_v_rstats_pidx.data + __pyx_t_10 * __pyx_v_rstats_pidx.strides[0]) ))));
    } else {
      __pyx_t_11 = NULL;
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">206</span>:                     &amp;rstats_radius[0] if rstats_radius is not None else NULL,</pre>
<pre class='cython code score-2 '>    __pyx_t_1 = (((PyObject *) __pyx_v_rstats_radius.memview) != Py_None);
    if (__pyx_t_1) {
      __pyx_t_10 = 0;
      __pyx_t_4 = -1;
      if (__pyx_t_10 &lt; 0) {
        __pyx_t_10 += __pyx_v_rstats_radius.shape[0];
        if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_4 = 0;
      } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_rstats_radius.shape[0])) __pyx_t_4 = 0;
      if (unlikely(__pyx_t_4 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
        <span class='error_goto'>__PYX_ERR(0, 206, __pyx_L1_error)</span>
      }
      __pyx_t_9 = (&amp;(*((int *) ( /* dim=0 */ (__pyx_v_rstats_radius.data + __pyx_t_10 * __pyx_v_rstats_radius.strides[0]) ))));
    } else {
      __pyx_t_9 = NULL;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">207</span>:                     fast, asic_nx, asic_ny, nasics_x, nasics_y, adc_thresh,</pre>
<pre class="cython line score-0">&#xA0;<span class="">208</span>:                     hitfinder_min_snr, hitfinder_min_pix_count, hitfinder_max_pix_count,</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>:                     hitfinder_local_bg_radius, &amp;outlier_mask[0, 0])</pre>
<pre class='cython code score-2 '>    __pyx_t_10 = 0;
    __pyx_t_12 = 0;
    __pyx_t_4 = -1;
    if (__pyx_t_10 &lt; 0) {
      __pyx_t_10 += __pyx_v_outlier_mask.shape[0];
      if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_4 = 0;
    } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_outlier_mask.shape[0])) __pyx_t_4 = 0;
    if (__pyx_t_12 &lt; 0) {
      __pyx_t_12 += __pyx_v_outlier_mask.shape[1];
      if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_4 = 1;
    } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_outlier_mask.shape[1])) __pyx_t_4 = 1;
    if (unlikely(__pyx_t_4 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_4);
      <span class='error_goto'>__PYX_ERR(0, 209, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">210</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">211</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">212</span>:     cdef int i</pre>
<pre class="cython line score-0">&#xA0;<span class="">213</span>:     cdef float peak_x, peak_y, peak_value</pre>
<pre class="cython line score-0">&#xA0;<span class="">214</span>:     cdef vector[double] peak_list_x</pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>:     cdef vector[double] peak_list_y</pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>:     cdef vector[long] peak_list_index</pre>
<pre class="cython line score-0">&#xA0;<span class="">217</span>:     cdef vector[double] peak_list_value</pre>
<pre class="cython line score-0">&#xA0;<span class="">218</span>:     cdef vector[double] peak_list_npix</pre>
<pre class="cython line score-0">&#xA0;<span class="">219</span>:     cdef vector[double] peak_list_maxi</pre>
<pre class="cython line score-0">&#xA0;<span class="">220</span>:     cdef vector[double] peak_list_sigma</pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>:     cdef vector[double] peak_list_snr</pre>
<pre class="cython line score-0">&#xA0;<span class="">222</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>:     num_peaks = peak_list.nPeaks</pre>
<pre class='cython code score-0 '>  __pyx_t_13 = __pyx_v_peak_list.nPeaks;
  __pyx_v_num_peaks = __pyx_t_13;
</pre><pre class="cython line score-0">&#xA0;<span class="">224</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">225</span>:     if num_peaks &gt; max_num_peaks:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_num_peaks &gt; __pyx_v_max_num_peaks);
  if (__pyx_t_1) {
/*  */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">226</span>:         num_peaks = max_num_peaks</pre>
<pre class='cython code score-0 '>    __pyx_v_num_peaks = __pyx_v_max_num_peaks;
</pre><pre class="cython line score-0">&#xA0;<span class="">227</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">228</span>:     for i in range(0, num_peaks):</pre>
<pre class='cython code score-0 '>  __pyx_t_13 = __pyx_v_num_peaks;
  __pyx_t_14 = __pyx_t_13;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_14; __pyx_t_4+=1) {
    __pyx_v_i = __pyx_t_4;
</pre><pre class="cython line score-0">&#xA0;<span class="">229</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">230</span>:         peak_x = peak_list.peak_com_x[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_x = (__pyx_v_peak_list.peak_com_x[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">231</span>:         peak_y = peak_list.peak_com_y[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_y = (__pyx_v_peak_list.peak_com_y[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">232</span>:         peak_index = peak_list.peak_com_index[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_index = (__pyx_v_peak_list.peak_com_index[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">233</span>:         peak_value = peak_list.peak_totalintensity[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_value = (__pyx_v_peak_list.peak_totalintensity[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">234</span>:         peak_npix = peak_list.peak_npix[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_npix = (__pyx_v_peak_list.peak_npix[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">235</span>:         peak_maxi = peak_list.peak_maxintensity[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_maxi = (__pyx_v_peak_list.peak_maxintensity[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">236</span>:         peak_sigma = peak_list.peak_sigma[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_sigma = (__pyx_v_peak_list.peak_sigma[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>:         peak_snr = peak_list.peak_snr[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_snr = (__pyx_v_peak_list.peak_snr[__pyx_v_i]);
</pre><pre class="cython line score-0">&#xA0;<span class="">238</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">239</span>:         peak_list_x.push_back(peak_x)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_x.push_back(__pyx_v_peak_x);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 239, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">240</span>:         peak_list_y.push_back(peak_y)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_y.push_back(__pyx_v_peak_y);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">241</span>:         peak_list_index.push_back(peak_index)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_index.push_back(__pyx_v_peak_index);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 241, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>:         peak_list_value.push_back(peak_value)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_value.push_back(__pyx_v_peak_value);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 242, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>:         peak_list_npix.push_back(peak_npix)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_npix.push_back(__pyx_v_peak_npix);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 243, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">244</span>:         peak_list_maxi.push_back(peak_maxi)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_maxi.push_back(__pyx_v_peak_maxi);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 244, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">245</span>:         peak_list_sigma.push_back(peak_sigma)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_sigma.push_back(__pyx_v_peak_sigma);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 245, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">246</span>:         peak_list_snr.push_back(peak_snr)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_snr.push_back(__pyx_v_peak_snr);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 246, __pyx_L1_error)</span>
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">247</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">248</span>:     freePeakList(peak_list)</pre>
<pre class='cython code score-0 '>  freePeakList(__pyx_v_peak_list);
</pre><pre class="cython line score-0">&#xA0;<span class="">249</span>: </pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">250</span>:     return (peak_list_x, peak_list_y, peak_list_value, peak_list_index,</pre>
<pre class='cython code score-30 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_15 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_x);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_16 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_y);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  __pyx_t_17 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_value);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_18 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_long</span>(__pyx_v_peak_list_index);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
/*  */
  __pyx_t_23 = <span class='py_c_api'>PyTuple_New</span>(8);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 0, __pyx_t_15)) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 1, __pyx_t_16)) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 2, __pyx_t_17)) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_18);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 3, __pyx_t_18)) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 4, __pyx_t_19)) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_20);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 5, __pyx_t_20)) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_21);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 6, __pyx_t_21)) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_22);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 7, __pyx_t_22)) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>;
  __pyx_t_15 = 0;
  __pyx_t_16 = 0;
  __pyx_t_17 = 0;
  __pyx_t_18 = 0;
  __pyx_t_19 = 0;
  __pyx_t_20 = 0;
  __pyx_t_21 = 0;
  __pyx_t_22 = 0;
  __pyx_r = __pyx_t_23;
  __pyx_t_23 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">251</span>:             peak_list_npix, peak_list_maxi, peak_list_sigma, peak_list_snr)</pre>
<pre class='cython code score-8 '>  __pyx_t_19 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_npix);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 251, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  __pyx_t_20 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_maxi);<span class='error_goto'> if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 251, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_20);
  __pyx_t_21 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_sigma);<span class='error_goto'> if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 251, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_21);
  __pyx_t_22 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_snr);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 251, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
</pre><pre class="cython line score-0">&#xA0;<span class="">252</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>: </pre>
<pre class="cython line score-430" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">254</span>: def peakfinder_8_with_outliers(int max_num_peaks, float[:,::1] data, char[:,::1] mask,</pre>
<pre class='cython code score-430 '>static PyObject *__pyx_pf_2om_10algorithms_16_crystallography_6__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_memoryview_fromslice(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults1, __pyx_self)-&gt;__pyx_arg_outlier_mask, 2, (PyObject *(*)(char *)) __pyx_memview_get_char, (int (*)(char *, PyObject *)) __pyx_memview_set_char, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 254, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 254, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L1_error)</span>;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 254, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='refnanny'>__Pyx_GIVEREF</span>(Py_None);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_1, 1, Py_None)) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L1_error)</span>;
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("om.algorithms._crystallography.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_2om_10algorithms_16_crystallography_3peakfinder_8_with_outliers(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_2om_10algorithms_16_crystallography_2peakfinder_8_with_outliers, "\n    peakfinder_8(max_num_peaks, data, mask, pix_r, asic_nx, asic_ny, nasics_x,         nasics_y, adc_thresh, hitfinder_min_snr, hitfinder_min_pix_count,         hitfinder_max_pix_count, hitfinder_local_bg_radius, outlier_mask)\n    \n    Peakfinder8 peak detection.\n\n    This function finds peaks in a detector data frame using the 'peakfinder8'\n    strategy from the Cheetah software package. The 'peakfinder8' peak detection\n    strategy is described in the following publication:\n\n    A. Barty, R. A. Kirian, F. R. N. C. Maia, M. Hantke, C. H. Yoon, T. A. White,\n    and H. N. Chapman, \"Cheetah: software for high-throughput reduction and\n    analysis of serial femtosecond x-ray diffraction data\", J Appl  Crystallogr,\n    vol. 47, pp. 1118-1131 (2014).\n\n    Arguments:\n\n        max_num_peaks (:obj:`int`): The maximum number of peaks that will be retrieved\n            from each data frame. Additional peaks will be ignored.\n\n        data (:obj:`numpy.ndarray`): The detector data frame on which the peak finding\n            must be performed (as an numpy array of float32).\n\n        mask (:obj:`numpy.ndarray`): A numpy array of int8 storing a mask.  The map can\n            be used to mark areas of the data frame that must be excluded from the peak\n            search. \n\n            * The map must be a numpy array of the same shape as the data frame on\n              which the algorithm will be applied.\n\n            * Each pixel in the map must have a value of either 0, meaning that\n              the corresponding pixel in the data frame should be ignored, or 1,\n              meaning that the corresponding pixel should be included in the\n              search.\n\n            * The map is only used to exclude areas from the peak search: the data\n              is not modified in any way.\n\n        pix_r (:obj:`numpy.ndarray`): A numpy array of float32 with radius information.\n\n            * The array must have the same shape as the data frame on ""which the\n              algorithm will be applied.\n\n            * Each element of the array must store, for the corresponding pixel in the\n              data frame, the distance in pixels from the origin of the detector\n              reference system (usually the center of the detector).\n\n        asic_nx (:obj:`int`):: The fs size in pixels of each detector panel in the data\n            frame.\n\n        asic_ny (:obj:`int`):: The ss size in pixels of each detector panel in the data\n            frame.\n\n        nasics_x (:obj:`int`): The number of panels along the fs axis of the data\n            frame.\n\n        nasics_y (:obj:`int`): The number of panels along the ss axis of the data\n            frame.\n\n        adc_thresh (:obj:`float`):: The minimum ADC threshold for peak detection.\n\n        hitfinder_min_snr (:obj:`float`): The minimum signal-to-noise ratio for peak\n            detection.\n\n        hitfinder_min_pix_count (:obj:`int`): The minimum size of a peak in pixels.\n\n        hitfinder_max_pixel_count (:obj:`int`): The maximum size of a peak in pixels.\n\n        local_bg_radius: The radius for the estimation of the local background in\n            pixels.\n\n        outliers (:obj:`numpy.ndarray`): An array of the same size and shape as the\n            array storing the detector data on which the peak finding is perfomed.\n            This array is modified during the function call: after the call, it stores\n            the internal \"outliers\" pixel classification mask generated by the\n            peakfinder8 algorithm.\n\n             * After the function returns, each pixel in the array stores the\n               classification information for the corresponding pixel in the detector\n               data array.\n\n    Returns:\n\n        :obj:`Tuple[int, List[float], List[float], List[float], List[float], List[float], List[float]`: A tuple storing  information about the detected peaks. The\n        tuple has the following element""s:\n\n            * The first entry stores the number of peaks that were detected in the data\n            frame.\n\n            * The second entry is a list storing the fractional fs indexes that locate\n            thedetected peaks in the data frame.\n    \n            * The third entry is a list storing the fractional ss indexes that locate the\n            the detected peaks in the data frame.\n    \n            * The fourth entry is a list storing the integrated intensities for the\n            detected peaks.\n    \n            * The fifth entry is a list storing the number of pixels that make up each\n            detected peak.\n\n            * The sixth entry is a list storing, for each peak, the value of the pixel\n            with the maximum intensity.\n    \n            * The seventh entry is a list storing the signal-to-noise ratio of each\n            detected peak.\n    ");
static PyMethodDef __pyx_mdef_2om_10algorithms_16_crystallography_3peakfinder_8_with_outliers = {"peakfinder_8_with_outliers", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_2om_10algorithms_16_crystallography_3peakfinder_8_with_outliers, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_2om_10algorithms_16_crystallography_2peakfinder_8_with_outliers};
static PyObject *__pyx_pw_2om_10algorithms_16_crystallography_3peakfinder_8_with_outliers(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  int __pyx_v_max_num_peaks;
  __Pyx_memviewslice __pyx_v_data = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_pix_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_rstats_num_pix;
  __Pyx_memviewslice __pyx_v_rstats_pidx = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_rstats_radius = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_fast;
  long __pyx_v_asic_nx;
  long __pyx_v_asic_ny;
  long __pyx_v_nasics_x;
  long __pyx_v_nasics_y;
  float __pyx_v_adc_thresh;
  float __pyx_v_hitfinder_min_snr;
  long __pyx_v_hitfinder_min_pix_count;
  long __pyx_v_hitfinder_max_pix_count;
  long __pyx_v_hitfinder_local_bg_radius;
  __Pyx_memviewslice __pyx_v_outlier_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("peakfinder_8_with_outliers (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_max_num_peaks,&amp;__pyx_n_s_data,&amp;__pyx_n_s_mask,&amp;__pyx_n_s_pix_r,&amp;__pyx_n_s_rstats_num_pix,&amp;__pyx_n_s_rstats_pidx,&amp;__pyx_n_s_rstats_radius,&amp;__pyx_n_s_fast,&amp;__pyx_n_s_asic_nx,&amp;__pyx_n_s_asic_ny,&amp;__pyx_n_s_nasics_x,&amp;__pyx_n_s_nasics_y,&amp;__pyx_n_s_adc_thresh,&amp;__pyx_n_s_hitfinder_min_snr,&amp;__pyx_n_s_hitfinder_min_pix_count,&amp;__pyx_n_s_hitfinder_max_pix_count,&amp;__pyx_n_s_hitfinder_local_bg_radius,&amp;__pyx_n_s_outlier_mask,0};
  PyObject* values[18] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    __pyx_defaults1 *__pyx_dynamic_args = <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults1, __pyx_self);
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case 18: values[17] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_max_num_peaks)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 1); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_mask)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 2); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_pix_r)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[3]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 3); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_rstats_num_pix)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[4]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 4); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_rstats_pidx)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[5]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 5); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_rstats_radius)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[6]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 6); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_fast)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[7]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 7); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_asic_nx)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[8]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 8); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_asic_ny)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[9]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 9); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_nasics_x)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[10]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 10); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_nasics_y)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[11]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 11); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_adc_thresh)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[12]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 12); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_hitfinder_min_snr)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[13]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 13); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_hitfinder_min_pix_count)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[14]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 14); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_hitfinder_max_pix_count)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[15]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 15); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (likely((values[16] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_hitfinder_local_bg_radius)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[16]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, 16); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_outlier_mask);
          if (value) { values[17] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "peakfinder_8_with_outliers") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case 18: values[17] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 16);
        values[15] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 15);
        values[14] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 14);
        values[13] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 13);
        values[12] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 12);
        values[11] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 11);
        values[10] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 10);
        values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);
        values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);
        values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);
        values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);
        values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_max_num_peaks = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[0]); if (unlikely((__pyx_v_max_num_peaks == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
    __pyx_v_data = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_float</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_data.memview)) __PYX_ERR(0, 254, __pyx_L3_error)</span>
    __pyx_v_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_char</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_mask.memview)) __PYX_ERR(0, 254, __pyx_L3_error)</span>
    __pyx_v_pix_r = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_float</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_pix_r.memview)) __PYX_ERR(0, 255, __pyx_L3_error)</span>
    __pyx_v_rstats_num_pix = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[4]); if (unlikely((__pyx_v_rstats_num_pix == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 255, __pyx_L3_error)</span>
    __pyx_v_rstats_pidx = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_rstats_pidx.memview)) __PYX_ERR(0, 255, __pyx_L3_error)</span>
    __pyx_v_rstats_radius = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_rstats_radius.memview)) __PYX_ERR(0, 256, __pyx_L3_error)</span>
    __pyx_v_fast = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[7]); if (unlikely((__pyx_v_fast == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 256, __pyx_L3_error)</span>
    __pyx_v_asic_nx = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[8]); if (unlikely((__pyx_v_asic_nx == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 256, __pyx_L3_error)</span>
    __pyx_v_asic_ny = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[9]); if (unlikely((__pyx_v_asic_ny == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 256, __pyx_L3_error)</span>
    __pyx_v_nasics_x = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[10]); if (unlikely((__pyx_v_nasics_x == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 257, __pyx_L3_error)</span>
    __pyx_v_nasics_y = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[11]); if (unlikely((__pyx_v_nasics_y == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 257, __pyx_L3_error)</span>
    __pyx_v_adc_thresh = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[12]); if (unlikely((__pyx_v_adc_thresh == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 257, __pyx_L3_error)</span>
    __pyx_v_hitfinder_min_snr = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(values[13]); if (unlikely((__pyx_v_hitfinder_min_snr == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 258, __pyx_L3_error)</span>
    __pyx_v_hitfinder_min_pix_count = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[14]); if (unlikely((__pyx_v_hitfinder_min_pix_count == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 258, __pyx_L3_error)</span>
    __pyx_v_hitfinder_max_pix_count = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[15]); if (unlikely((__pyx_v_hitfinder_max_pix_count == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 259, __pyx_L3_error)</span>
    __pyx_v_hitfinder_local_bg_radius = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[16]); if (unlikely((__pyx_v_hitfinder_local_bg_radius == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 259, __pyx_L3_error)</span>
    if (values[17]) {
      __pyx_v_outlier_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_char</span>(values[17], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_outlier_mask.memview)) __PYX_ERR(0, 260, __pyx_L3_error)</span>
    } else {
      __pyx_v_outlier_mask = __pyx_dynamic_args-&gt;__pyx_arg_outlier_mask;
      __PYX_INC_MEMVIEW(&amp;__pyx_v_outlier_mask, 1);
    }
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("peakfinder_8_with_outliers", 0, 17, 18, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_mask, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_pix_r, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_rstats_pidx, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_rstats_radius, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_outlier_mask, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("om.algorithms._crystallography.peakfinder_8_with_outliers", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_2om_10algorithms_16_crystallography_2peakfinder_8_with_outliers(__pyx_self, __pyx_v_max_num_peaks, __pyx_v_data, __pyx_v_mask, __pyx_v_pix_r, __pyx_v_rstats_num_pix, __pyx_v_rstats_pidx, __pyx_v_rstats_radius, __pyx_v_fast, __pyx_v_asic_nx, __pyx_v_asic_ny, __pyx_v_nasics_x, __pyx_v_nasics_y, __pyx_v_adc_thresh, __pyx_v_hitfinder_min_snr, __pyx_v_hitfinder_min_pix_count, __pyx_v_hitfinder_max_pix_count, __pyx_v_hitfinder_local_bg_radius, __pyx_v_outlier_mask);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_data, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_mask, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_pix_r, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_rstats_pidx, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_rstats_radius, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_outlier_mask, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_2om_10algorithms_16_crystallography_2peakfinder_8_with_outliers(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_max_num_peaks, __Pyx_memviewslice __pyx_v_data, __Pyx_memviewslice __pyx_v_mask, __Pyx_memviewslice __pyx_v_pix_r, int __pyx_v_rstats_num_pix, __Pyx_memviewslice __pyx_v_rstats_pidx, __Pyx_memviewslice __pyx_v_rstats_radius, int __pyx_v_fast, long __pyx_v_asic_nx, long __pyx_v_asic_ny, long __pyx_v_nasics_x, long __pyx_v_nasics_y, float __pyx_v_adc_thresh, float __pyx_v_hitfinder_min_snr, long __pyx_v_hitfinder_min_pix_count, long __pyx_v_hitfinder_max_pix_count, long __pyx_v_hitfinder_local_bg_radius, __Pyx_memviewslice __pyx_v_outlier_mask) {
  tPeakList __pyx_v_peak_list;
  int __pyx_v_i;
  float __pyx_v_peak_x;
  float __pyx_v_peak_y;
  float __pyx_v_peak_value;
  std::vector&lt;double&gt;  __pyx_v_peak_list_x;
  std::vector&lt;double&gt;  __pyx_v_peak_list_y;
  std::vector&lt;long&gt;  __pyx_v_peak_list_index;
  std::vector&lt;double&gt;  __pyx_v_peak_list_value;
  std::vector&lt;double&gt;  __pyx_v_peak_list_npix;
  std::vector&lt;double&gt;  __pyx_v_peak_list_maxi;
  std::vector&lt;double&gt;  __pyx_v_peak_list_sigma;
  std::vector&lt;double&gt;  __pyx_v_peak_list_snr;
  long __pyx_v_num_peaks;
  long __pyx_v_peak_index;
  float __pyx_v_peak_npix;
  float __pyx_v_peak_maxi;
  float __pyx_v_peak_sigma;
  float __pyx_v_peak_snr;
  PyObject *__pyx_r = NULL;
/*  */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_21);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_23);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("om.algorithms._crystallography.peakfinder_8_with_outliers", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/*  */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_2om_10algorithms_16_crystallography_3peakfinder_8_with_outliers, 0, __pyx_n_s_peakfinder_8_with_outliers, NULL, __pyx_n_s_om_algorithms__crystallography, __pyx_d, ((PyObject *)__pyx_codeobj__22));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 254, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (!<span class='pyx_c_api'>__Pyx_CyFunction_InitDefaults</span>(__pyx_t_7, sizeof(__pyx_defaults1), 0)) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">255</span>:                  float[:,::1] pix_r, int rstats_num_pix, int[:] rstats_pidx,</pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>:                  int[:] rstats_radius, int fast, long asic_nx, long asic_ny,</pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>:                  long nasics_x, long nasics_y, float adc_thresh,</pre>
<pre class="cython line score-0">&#xA0;<span class="">258</span>:                  float hitfinder_min_snr, long hitfinder_min_pix_count,</pre>
<pre class="cython line score-0">&#xA0;<span class="">259</span>:                  long hitfinder_max_pix_count, long hitfinder_local_bg_radius,</pre>
<pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">260</span>:                  char[:,::1] outlier_mask=None):</pre>
<pre class='cython code score-12 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_char</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 260, __pyx_L1_error)</span>
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults1, __pyx_t_7)-&gt;__pyx_arg_outlier_mask = __pyx_t_9;
  __pyx_t_9.memview = NULL;
  __pyx_t_9.data = NULL;
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsGetter</span>(__pyx_t_7, __pyx_pf_2om_10algorithms_16_crystallography_6__defaults__);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_peakfinder_8_with_outliers, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 254, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">261</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">262</span>:     peakfinder_8(max_num_peaks, data, mask, pix_r, asic_nx, asic_ny, nasics_x, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">263</span>:         nasics_y, adc_thresh, hitfinder_min_snr, hitfinder_min_pix_count, \</pre>
<pre class="cython line score-0">&#xA0;<span class="">264</span>:         hitfinder_max_pix_count, hitfinder_local_bg_radius, outlier_mask)</pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">266</span>:     Peakfinder8 peak detection.</pre>
<pre class="cython line score-0">&#xA0;<span class="">267</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">268</span>:     This function finds peaks in a detector data frame using the 'peakfinder8'</pre>
<pre class="cython line score-0">&#xA0;<span class="">269</span>:     strategy from the Cheetah software package. The 'peakfinder8' peak detection</pre>
<pre class="cython line score-0">&#xA0;<span class="">270</span>:     strategy is described in the following publication:</pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">272</span>:     A. Barty, R. A. Kirian, F. R. N. C. Maia, M. Hantke, C. H. Yoon, T. A. White,</pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>:     and H. N. Chapman, "Cheetah: software for high-throughput reduction and</pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>:     analysis of serial femtosecond x-ray diffraction data", J Appl  Crystallogr,</pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>:     vol. 47, pp. 1118-1131 (2014).</pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">277</span>:     Arguments:</pre>
<pre class="cython line score-0">&#xA0;<span class="">278</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">279</span>:         max_num_peaks (:obj:`int`): The maximum number of peaks that will be retrieved</pre>
<pre class="cython line score-0">&#xA0;<span class="">280</span>:             from each data frame. Additional peaks will be ignored.</pre>
<pre class="cython line score-0">&#xA0;<span class="">281</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">282</span>:         data (:obj:`numpy.ndarray`): The detector data frame on which the peak finding</pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>:             must be performed (as an numpy array of float32).</pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">285</span>:         mask (:obj:`numpy.ndarray`): A numpy array of int8 storing a mask.  The map can</pre>
<pre class="cython line score-0">&#xA0;<span class="">286</span>:             be used to mark areas of the data frame that must be excluded from the peak</pre>
<pre class="cython line score-0">&#xA0;<span class="">287</span>:             search.</pre>
<pre class="cython line score-0">&#xA0;<span class="">288</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">289</span>:             * The map must be a numpy array of the same shape as the data frame on</pre>
<pre class="cython line score-0">&#xA0;<span class="">290</span>:               which the algorithm will be applied.</pre>
<pre class="cython line score-0">&#xA0;<span class="">291</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">292</span>:             * Each pixel in the map must have a value of either 0, meaning that</pre>
<pre class="cython line score-0">&#xA0;<span class="">293</span>:               the corresponding pixel in the data frame should be ignored, or 1,</pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>:               meaning that the corresponding pixel should be included in the</pre>
<pre class="cython line score-0">&#xA0;<span class="">295</span>:               search.</pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>:             * The map is only used to exclude areas from the peak search: the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">298</span>:               is not modified in any way.</pre>
<pre class="cython line score-0">&#xA0;<span class="">299</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>:         pix_r (:obj:`numpy.ndarray`): A numpy array of float32 with radius information.</pre>
<pre class="cython line score-0">&#xA0;<span class="">301</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">302</span>:             * The array must have the same shape as the data frame on which the</pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>:               algorithm will be applied.</pre>
<pre class="cython line score-0">&#xA0;<span class="">304</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">305</span>:             * Each element of the array must store, for the corresponding pixel in the</pre>
<pre class="cython line score-0">&#xA0;<span class="">306</span>:               data frame, the distance in pixels from the origin of the detector</pre>
<pre class="cython line score-0">&#xA0;<span class="">307</span>:               reference system (usually the center of the detector).</pre>
<pre class="cython line score-0">&#xA0;<span class="">308</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">309</span>:         asic_nx (:obj:`int`):: The fs size in pixels of each detector panel in the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">310</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">311</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">312</span>:         asic_ny (:obj:`int`):: The ss size in pixels of each detector panel in the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">313</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">314</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">315</span>:         nasics_x (:obj:`int`): The number of panels along the fs axis of the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">316</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">317</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">318</span>:         nasics_y (:obj:`int`): The number of panels along the ss axis of the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">319</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">320</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">321</span>:         adc_thresh (:obj:`float`):: The minimum ADC threshold for peak detection.</pre>
<pre class="cython line score-0">&#xA0;<span class="">322</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">323</span>:         hitfinder_min_snr (:obj:`float`): The minimum signal-to-noise ratio for peak</pre>
<pre class="cython line score-0">&#xA0;<span class="">324</span>:             detection.</pre>
<pre class="cython line score-0">&#xA0;<span class="">325</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">326</span>:         hitfinder_min_pix_count (:obj:`int`): The minimum size of a peak in pixels.</pre>
<pre class="cython line score-0">&#xA0;<span class="">327</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">328</span>:         hitfinder_max_pixel_count (:obj:`int`): The maximum size of a peak in pixels.</pre>
<pre class="cython line score-0">&#xA0;<span class="">329</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">330</span>:         local_bg_radius: The radius for the estimation of the local background in</pre>
<pre class="cython line score-0">&#xA0;<span class="">331</span>:             pixels.</pre>
<pre class="cython line score-0">&#xA0;<span class="">332</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">333</span>:         outliers (:obj:`numpy.ndarray`): An array of the same size and shape as the</pre>
<pre class="cython line score-0">&#xA0;<span class="">334</span>:             array storing the detector data on which the peak finding is perfomed.</pre>
<pre class="cython line score-0">&#xA0;<span class="">335</span>:             This array is modified during the function call: after the call, it stores</pre>
<pre class="cython line score-0">&#xA0;<span class="">336</span>:             the internal "outliers" pixel classification mask generated by the</pre>
<pre class="cython line score-0">&#xA0;<span class="">337</span>:             peakfinder8 algorithm.</pre>
<pre class="cython line score-0">&#xA0;<span class="">338</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">339</span>:              * After the function returns, each pixel in the array stores the</pre>
<pre class="cython line score-0">&#xA0;<span class="">340</span>:                classification information for the corresponding pixel in the detector</pre>
<pre class="cython line score-0">&#xA0;<span class="">341</span>:                data array.</pre>
<pre class="cython line score-0">&#xA0;<span class="">342</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">343</span>:     Returns:</pre>
<pre class="cython line score-0">&#xA0;<span class="">344</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">345</span>:         :obj:`Tuple[int, List[float], List[float], List[float], List[float], \</pre>
<pre class="cython line score-0">&#xA0;<span class="">346</span>: List[float], List[float]`: A tuple storing  information about the detected peaks. The</pre>
<pre class="cython line score-0">&#xA0;<span class="">347</span>:         tuple has the following elements:</pre>
<pre class="cython line score-0">&#xA0;<span class="">348</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">349</span>:             * The first entry stores the number of peaks that were detected in the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">350</span>:             frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">351</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">352</span>:             * The second entry is a list storing the fractional fs indexes that locate</pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>:             thedetected peaks in the data frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">354</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">355</span>:             * The third entry is a list storing the fractional ss indexes that locate the</pre>
<pre class="cython line score-0">&#xA0;<span class="">356</span>:             the detected peaks in the data frame.</pre>
<pre class="cython line score-0">&#xA0;<span class="">357</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">358</span>:             * The fourth entry is a list storing the integrated intensities for the</pre>
<pre class="cython line score-0">&#xA0;<span class="">359</span>:             detected peaks.</pre>
<pre class="cython line score-0">&#xA0;<span class="">360</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">361</span>:             * The fifth entry is a list storing the number of pixels that make up each</pre>
<pre class="cython line score-0">&#xA0;<span class="">362</span>:             detected peak.</pre>
<pre class="cython line score-0">&#xA0;<span class="">363</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">364</span>:             * The sixth entry is a list storing, for each peak, the value of the pixel</pre>
<pre class="cython line score-0">&#xA0;<span class="">365</span>:             with the maximum intensity.</pre>
<pre class="cython line score-0">&#xA0;<span class="">366</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">367</span>:             * The seventh entry is a list storing the signal-to-noise ratio of each</pre>
<pre class="cython line score-0">&#xA0;<span class="">368</span>:             detected peak.</pre>
<pre class="cython line score-0">&#xA0;<span class="">369</span>:     """</pre>
<pre class="cython line score-0">&#xA0;<span class="">370</span>:     cdef tPeakList peak_list</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">371</span>:     allocatePeakList(&amp;peak_list, max_num_peaks)</pre>
<pre class='cython code score-0 '>  allocatePeakList((&amp;__pyx_v_peak_list), __pyx_v_max_num_peaks);
</pre><pre class="cython line score-0">&#xA0;<span class="">372</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">373</span>:     peakfinder8(&amp;peak_list, &amp;data[0, 0], &amp;mask[0,0], &amp;pix_r[0, 0], rstats_num_pix,</pre>
<pre class='cython code score-6 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = -1;
  if (__pyx_t_1 &lt; 0) {
    __pyx_t_1 += __pyx_v_data.shape[0];
    if (unlikely(__pyx_t_1 &lt; 0)) __pyx_t_3 = 0;
  } else if (unlikely(__pyx_t_1 &gt;= __pyx_v_data.shape[0])) __pyx_t_3 = 0;
  if (__pyx_t_2 &lt; 0) {
    __pyx_t_2 += __pyx_v_data.shape[1];
    if (unlikely(__pyx_t_2 &lt; 0)) __pyx_t_3 = 1;
  } else if (unlikely(__pyx_t_2 &gt;= __pyx_v_data.shape[1])) __pyx_t_3 = 1;
  if (unlikely(__pyx_t_3 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
    <span class='error_goto'>__PYX_ERR(0, 373, __pyx_L1_error)</span>
  }
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_3 = -1;
  if (__pyx_t_4 &lt; 0) {
    __pyx_t_4 += __pyx_v_mask.shape[0];
    if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_3 = 0;
  } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_mask.shape[0])) __pyx_t_3 = 0;
  if (__pyx_t_5 &lt; 0) {
    __pyx_t_5 += __pyx_v_mask.shape[1];
    if (unlikely(__pyx_t_5 &lt; 0)) __pyx_t_3 = 1;
  } else if (unlikely(__pyx_t_5 &gt;= __pyx_v_mask.shape[1])) __pyx_t_3 = 1;
  if (unlikely(__pyx_t_3 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
    <span class='error_goto'>__PYX_ERR(0, 373, __pyx_L1_error)</span>
  }
  __pyx_t_6 = 0;
  __pyx_t_7 = 0;
  __pyx_t_3 = -1;
  if (__pyx_t_6 &lt; 0) {
    __pyx_t_6 += __pyx_v_pix_r.shape[0];
    if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_3 = 0;
  } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_pix_r.shape[0])) __pyx_t_3 = 0;
  if (__pyx_t_7 &lt; 0) {
    __pyx_t_7 += __pyx_v_pix_r.shape[1];
    if (unlikely(__pyx_t_7 &lt; 0)) __pyx_t_3 = 1;
  } else if (unlikely(__pyx_t_7 &gt;= __pyx_v_pix_r.shape[1])) __pyx_t_3 = 1;
  if (unlikely(__pyx_t_3 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
    <span class='error_goto'>__PYX_ERR(0, 373, __pyx_L1_error)</span>
  }
/*  */
  (void)(peakfinder8((&amp;__pyx_v_peak_list), (&amp;(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_data.data + __pyx_t_1 * __pyx_v_data.strides[0]) )) + __pyx_t_2)) )))), (&amp;(*((char *) ( /* dim=1 */ ((char *) (((char *) ( /* dim=0 */ (__pyx_v_mask.data + __pyx_t_4 * __pyx_v_mask.strides[0]) )) + __pyx_t_5)) )))), (&amp;(*((float *) ( /* dim=1 */ ((char *) (((float *) ( /* dim=0 */ (__pyx_v_pix_r.data + __pyx_t_6 * __pyx_v_pix_r.strides[0]) )) + __pyx_t_7)) )))), __pyx_v_rstats_num_pix, __pyx_t_8, __pyx_t_11, __pyx_v_fast, __pyx_v_asic_nx, __pyx_v_asic_ny, __pyx_v_nasics_x, __pyx_v_nasics_y, __pyx_v_adc_thresh, __pyx_v_hitfinder_min_snr, __pyx_v_hitfinder_min_pix_count, __pyx_v_hitfinder_max_pix_count, __pyx_v_hitfinder_local_bg_radius, (&amp;(*((char *) ( /* dim=1 */ ((char *) (((char *) ( /* dim=0 */ (__pyx_v_outlier_mask.data + __pyx_t_10 * __pyx_v_outlier_mask.strides[0]) )) + __pyx_t_12)) ))))));
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">374</span>:                 &amp;rstats_pidx[0] if rstats_pidx is not None else NULL,</pre>
<pre class='cython code score-2 '>  __pyx_t_9 = (((PyObject *) __pyx_v_rstats_pidx.memview) != Py_None);
  if (__pyx_t_9) {
    __pyx_t_10 = 0;
    __pyx_t_3 = -1;
    if (__pyx_t_10 &lt; 0) {
      __pyx_t_10 += __pyx_v_rstats_pidx.shape[0];
      if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_3 = 0;
    } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_rstats_pidx.shape[0])) __pyx_t_3 = 0;
    if (unlikely(__pyx_t_3 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
      <span class='error_goto'>__PYX_ERR(0, 374, __pyx_L1_error)</span>
    }
    __pyx_t_8 = (&amp;(*((int *) ( /* dim=0 */ (__pyx_v_rstats_pidx.data + __pyx_t_10 * __pyx_v_rstats_pidx.strides[0]) ))));
  } else {
    __pyx_t_8 = NULL;
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">375</span>:                 &amp;rstats_radius[0] if rstats_radius is not None else NULL,</pre>
<pre class='cython code score-2 '>  __pyx_t_9 = (((PyObject *) __pyx_v_rstats_radius.memview) != Py_None);
  if (__pyx_t_9) {
    __pyx_t_10 = 0;
    __pyx_t_3 = -1;
    if (__pyx_t_10 &lt; 0) {
      __pyx_t_10 += __pyx_v_rstats_radius.shape[0];
      if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_3 = 0;
    } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_rstats_radius.shape[0])) __pyx_t_3 = 0;
    if (unlikely(__pyx_t_3 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
      <span class='error_goto'>__PYX_ERR(0, 375, __pyx_L1_error)</span>
    }
    __pyx_t_11 = (&amp;(*((int *) ( /* dim=0 */ (__pyx_v_rstats_radius.data + __pyx_t_10 * __pyx_v_rstats_radius.strides[0]) ))));
  } else {
    __pyx_t_11 = NULL;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">376</span>:                 fast, asic_nx, asic_ny, nasics_x, nasics_y, adc_thresh,</pre>
<pre class="cython line score-0">&#xA0;<span class="">377</span>:                 hitfinder_min_snr, hitfinder_min_pix_count, hitfinder_max_pix_count,</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">378</span>:                 hitfinder_local_bg_radius, &amp;outlier_mask[0,0])</pre>
<pre class='cython code score-2 '>  __pyx_t_10 = 0;
  __pyx_t_12 = 0;
  __pyx_t_3 = -1;
  if (__pyx_t_10 &lt; 0) {
    __pyx_t_10 += __pyx_v_outlier_mask.shape[0];
    if (unlikely(__pyx_t_10 &lt; 0)) __pyx_t_3 = 0;
  } else if (unlikely(__pyx_t_10 &gt;= __pyx_v_outlier_mask.shape[0])) __pyx_t_3 = 0;
  if (__pyx_t_12 &lt; 0) {
    __pyx_t_12 += __pyx_v_outlier_mask.shape[1];
    if (unlikely(__pyx_t_12 &lt; 0)) __pyx_t_3 = 1;
  } else if (unlikely(__pyx_t_12 &gt;= __pyx_v_outlier_mask.shape[1])) __pyx_t_3 = 1;
  if (unlikely(__pyx_t_3 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_3);
    <span class='error_goto'>__PYX_ERR(0, 378, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">379</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">380</span>:     cdef int i</pre>
<pre class="cython line score-0">&#xA0;<span class="">381</span>:     cdef float peak_x, peak_y, peak_value</pre>
<pre class="cython line score-0">&#xA0;<span class="">382</span>:     cdef vector[double] peak_list_x</pre>
<pre class="cython line score-0">&#xA0;<span class="">383</span>:     cdef vector[double] peak_list_y</pre>
<pre class="cython line score-0">&#xA0;<span class="">384</span>:     cdef vector[long] peak_list_index</pre>
<pre class="cython line score-0">&#xA0;<span class="">385</span>:     cdef vector[double] peak_list_value</pre>
<pre class="cython line score-0">&#xA0;<span class="">386</span>:     cdef vector[double] peak_list_npix</pre>
<pre class="cython line score-0">&#xA0;<span class="">387</span>:     cdef vector[double] peak_list_maxi</pre>
<pre class="cython line score-0">&#xA0;<span class="">388</span>:     cdef vector[double] peak_list_sigma</pre>
<pre class="cython line score-0">&#xA0;<span class="">389</span>:     cdef vector[double] peak_list_snr</pre>
<pre class="cython line score-0">&#xA0;<span class="">390</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">391</span>:     num_peaks = peak_list.nPeaks</pre>
<pre class='cython code score-0 '>  __pyx_t_13 = __pyx_v_peak_list.nPeaks;
  __pyx_v_num_peaks = __pyx_t_13;
</pre><pre class="cython line score-0">&#xA0;<span class="">392</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">393</span>:     if num_peaks &gt; max_num_peaks:</pre>
<pre class='cython code score-0 '>  __pyx_t_9 = (__pyx_v_num_peaks &gt; __pyx_v_max_num_peaks);
  if (__pyx_t_9) {
/*  */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">394</span>:         num_peaks = max_num_peaks</pre>
<pre class='cython code score-0 '>    __pyx_v_num_peaks = __pyx_v_max_num_peaks;
</pre><pre class="cython line score-0">&#xA0;<span class="">395</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>:     for i in range(0, num_peaks):</pre>
<pre class='cython code score-0 '>  __pyx_t_13 = __pyx_v_num_peaks;
  __pyx_t_14 = __pyx_t_13;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_14; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">397</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">398</span>:         peak_x = peak_list.peak_com_x[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_x = (__pyx_v_peak_list.peak_com_x[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">399</span>:         peak_y = peak_list.peak_com_y[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_y = (__pyx_v_peak_list.peak_com_y[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">400</span>:         peak_index = peak_list.peak_com_index[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_index = (__pyx_v_peak_list.peak_com_index[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">401</span>:         peak_value = peak_list.peak_totalintensity[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_value = (__pyx_v_peak_list.peak_totalintensity[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">402</span>:         peak_npix = peak_list.peak_npix[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_npix = (__pyx_v_peak_list.peak_npix[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">403</span>:         peak_maxi = peak_list.peak_maxintensity[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_maxi = (__pyx_v_peak_list.peak_maxintensity[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">404</span>:         peak_sigma = peak_list.peak_sigma[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_sigma = (__pyx_v_peak_list.peak_sigma[__pyx_v_i]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">405</span>:         peak_snr = peak_list.peak_snr[i]</pre>
<pre class='cython code score-0 '>    __pyx_v_peak_snr = (__pyx_v_peak_list.peak_snr[__pyx_v_i]);
</pre><pre class="cython line score-0">&#xA0;<span class="">406</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">407</span>:         peak_list_x.push_back(peak_x)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_x.push_back(__pyx_v_peak_x);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">408</span>:         peak_list_y.push_back(peak_y)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_y.push_back(__pyx_v_peak_y);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 408, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">409</span>:         peak_list_index.push_back(peak_index)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_index.push_back(__pyx_v_peak_index);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 409, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">410</span>:         peak_list_value.push_back(peak_value)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_value.push_back(__pyx_v_peak_value);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 410, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">411</span>:         peak_list_npix.push_back(peak_npix)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_npix.push_back(__pyx_v_peak_npix);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 411, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">412</span>:         peak_list_maxi.push_back(peak_maxi)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_maxi.push_back(__pyx_v_peak_maxi);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 412, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">413</span>:         peak_list_sigma.push_back(peak_sigma)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_sigma.push_back(__pyx_v_peak_sigma);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 413, __pyx_L1_error)</span>
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">414</span>:         peak_list_snr.push_back(peak_snr)</pre>
<pre class='cython code score-0 '>    try {
      __pyx_v_peak_list_snr.push_back(__pyx_v_peak_snr);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 414, __pyx_L1_error)</span>
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">415</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">416</span>:     freePeakList(peak_list)</pre>
<pre class='cython code score-0 '>  freePeakList(__pyx_v_peak_list);
</pre><pre class="cython line score-0">&#xA0;<span class="">417</span>: </pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">418</span>:     return (peak_list_x, peak_list_y, peak_list_value, peak_list_index,</pre>
<pre class='cython code score-30 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_15 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_x);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_16 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_y);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  __pyx_t_17 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_value);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_18 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_long</span>(__pyx_v_peak_list_index);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
/*  */
  __pyx_t_23 = <span class='py_c_api'>PyTuple_New</span>(8);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 0, __pyx_t_15)) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 1, __pyx_t_16)) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 2, __pyx_t_17)) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_18);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 3, __pyx_t_18)) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 4, __pyx_t_19)) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_20);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 5, __pyx_t_20)) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_21);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 6, __pyx_t_21)) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_22);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_23, 7, __pyx_t_22)) <span class='error_goto'>__PYX_ERR(0, 418, __pyx_L1_error)</span>;
  __pyx_t_15 = 0;
  __pyx_t_16 = 0;
  __pyx_t_17 = 0;
  __pyx_t_18 = 0;
  __pyx_t_19 = 0;
  __pyx_t_20 = 0;
  __pyx_t_21 = 0;
  __pyx_t_22 = 0;
  __pyx_r = __pyx_t_23;
  __pyx_t_23 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">419</span>:             peak_list_npix, peak_list_maxi, peak_list_sigma, peak_list_snr)</pre>
<pre class='cython code score-8 '>  __pyx_t_19 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_npix);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  __pyx_t_20 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_maxi);<span class='error_goto'> if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_20);
  __pyx_t_21 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_sigma);<span class='error_goto'> if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_21);
  __pyx_t_22 = <span class='pyx_c_api'>__pyx_convert_vector_to_py_double</span>(__pyx_v_peak_list_snr);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
</pre><pre class="cython line score-0">&#xA0;<span class="">420</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">421</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">422</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">423</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">424</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">425</span>: </pre>
</div></body></html>
